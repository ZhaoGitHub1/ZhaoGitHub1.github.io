---
title: 面试之---中间件相关
categories: interview
tags: 
  - 总结
  - 中间件
date: 2018-09-16 21:02:51
description: 包含常见的中间件等相关面试知识汇总
---

** {{ title }}：** <Excerpt in index | 首页摘要>

<!-- more -->
<The rest of contents | 余下全文>

![](interview-middleware/interview.png)

> 持续维护java面试题系列博文，发现好的面试题会更新进来。总结的并不只是如何回答面试官，而是这道题涉及到的知识点，明白了相关知识点和面试官要问的点，回答起来就不是问题了。

## 综合

### 消息队列有哪些使用场景？

一般来说，有四大类使用场景：

- 应用解耦
- 异步处理
- 流量削峰
- 消息通讯
- 日志处理

其中，应用解耦、异步处理是比较核心的。

### 消息队列有什么优缺点？

任何中间件的引入，带来优点的时候，也同时会带来缺点。

缺点，主要是如下三点：

1. 系统可用性降低：系统引入的外部依赖越多，越容易挂掉。本来你就是 A 系统调用 BCD 三个系统的接口就好了，本来 ABCD 四个系统好好的，没啥问题，你偏加个 MQ 进来，万一 MQ 挂了咋整，MQ 一挂，整套系统崩溃的，你不就完了？所以，消息队列一定要做好高可用。
2. 系统复杂度提高：主要需要多考虑，1）消息怎么不重复消息。2）消息怎么保证不丢失。3）需要消息顺序的业务场景，怎么处理。
3. 一致性问题：A 系统处理完了直接返回成功了，人都以为你这个请求就成功了。但是问题是，要是 B、C。D 三个系统那里，B、D 两个系统写库成功了，结果 C 系统写库失败了，咋整？你这数据就不一致了。当然，这不仅仅是 MQ 的问题，引入 RPC 之后本身就存在这样的问题。如果我们在使用 MQ 时，一定要达到数据的最终一致性。即，C 系统最终执行完成。

## Zookeeper

todo

## MongoDB

todo

## Redis

### redis支持的哪些数据结构？

Redis允许的value数据结构类型有5种：`String`（字符串）、`List`（列表）、`Set`（集合）、`Hash`（哈希）、`Zset`（有序集合）

### redis是如何持久化的？

redis提供两种持久化方式：`AOF`（Append Only File）和`RDB`（Redis DataBase）

### redis的watch实现原理？

### redis是否支持事务？

### redis如何实现主从复制？

### redis如何实现定制过期删除？

### redis有哪些集群模式？

### redis为什么 Redis 单线程模型也能效率这么高？

- C 语言实现。
- 纯内存操作。
- 基于非阻塞的 IO 多路复用机制。
- 单线程，避免了多线程的频繁上下文切换问题和资源竞争问题

### redis为什么放弃多线程，采用单线程？

单线程的设计已经足够快，性能瓶颈在内存或者网络上。

### 如何进行缓存预热？

发现热点数据

- 写代码（不推荐）
- 代理层抓包
- 通过facebook开源组件redis-faina，监听redis中key值变化，记录热点数据
- packetbeat插件

### 如何保证缓存一致性？

顾名思义，缓存一致性指数据库和缓存的数据一致性。

解决方案：

- 先更新库数据，再删除缓存

- 先删除缓存，再更新数据

  - > 当热点数据读缓存并发较高时，可以采用延时双删：先删除缓存，再更新数据库，再删除缓存.

### 如何解决缓存击穿？

缓存击穿是指key过期瞬间并发访问数据库读取新值，导致大量请求到DB。

解决方案：

- 设置热点数据永不过期
- 加互斥锁

### 如何解决缓存穿透？

缓存穿透是指查询一个根本不存在的数据，将导致不存在的数据每次请求都要到存储层去查询，失去了缓存保护后端存储的意义。

解决方案：

- 缓存空对象
  - 缺点：
    - 需要更多的缓存空间
    - 缓存层和存储层的数据会有一段时间窗口的不一致，可能会对业务有一定影响。例如过期时间设置为 5 分钟，如果此时存储层添加了这个数据，那此段时间就会出现缓存层和存储层数据的不一致，此时可以利用消息系统或者其他方式清除掉缓存层中的空对象。
- 布隆过滤器
  - 缺点：
    - 存在误判

### 如何解决缓存雪崩？

如果缓存层由于某些原因整体不能提供服务，于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。或者大量key同时过期，请求直接打到DB。

解决方案：

- 保证缓存层服务高可用性。
- 本地缓存
- 依赖隔离组件为后端限流并降级。
- 避免缓存的Key同时过期
- 请求DB限流
- 预更新即将过期的key

## ElasticSearch

todo

## Kafka

todo

## RibbitMQ

### RabbitMQ 有哪些重要的角色？ 

RabbitMQ 中重要的角色有：生产者、消费者和代理：

- 生产者：消息的创建者，负责创建和推送数据到消息服务器

- 消费者：消息的接收方，用于处理数据和确认消息

- 代理：就是 RabbitMQ 本身，用于扮演`快递`的角色，本身不生产消息，只是扮演“快递”的角色

## RocketMQ

todo

## ActiveMQ

todo

